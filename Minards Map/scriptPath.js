var dataArrObj = [{
    "LONP": "24",
    "LATP": "54.9",
    "SURV": "340000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "24.5",
    "LATP": "55",
    "SURV": "340000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "25.5",
    "LATP": "54.5",
    "SURV": "340000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "26",
    "LATP": "54.7",
    "SURV": "320000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "27",
    "LATP": "54.8",
    "SURV": "300000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "28",
    "LATP": "54.9",
    "SURV": "280000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "28.5",
    "LATP": "55",
    "SURV": "240000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "29",
    "LATP": "55.1",
    "SURV": "210000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "30",
    "LATP": "55.2",
    "SURV": "180000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "30.3",
    "LATP": "55.3",
    "SURV": "175000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "32",
    "LATP": "54.8",
    "SURV": "145000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "33.2",
    "LATP": "54.9",
    "SURV": "140000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "34.4",
    "LATP": "55.5",
    "SURV": "127100",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "35.5",
    "LATP": "55.4",
    "SURV": "100000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "36",
    "LATP": "55.5",
    "SURV": "100000",
    "DIR": "A",
    "DIV": "1"
}, {
    "LONP": "37.6",
    "LATP": "55.8",
    "SURV": "100000",
    "DIR": "R",
    "DIV": "1"
}, {
    "LONP": "37.5",
    "LATP": "55.7",
    "SURV": "98000",
    "DIR": "R",
    "DIV": "1"
}, {
    "LONP": "37",
    "LATP": "55",
    "SURV": "97000",
    "DIR": "R",
    "DIV": "1"
}, {
    "LONP": "36.8",
    "LATP": "55",
    "SURV": "96000",
    "DIR": "R",
    "DIV": "1"
}, {
    "LONP": "35.4",
    "LATP": "55.3",
    "SURV": "87000",
    "DIR": "R",
    "DIV": "1"
}, {
    "LONP": "34.3",
    "LATP": "55.2",
    "SURV": "55000",
    "DIR": "R",
    "DIV": "1"
}, {
    "LONP": "33.3",
    "LATP": "54.8",
    "SURV": "37000",
    "DIR": "R",
    "DIV": "1"
}, {
    "LONP": "32",
    "LATP": "54.6",
    "SURV": "24000",
    "DIR": "R",
    "DIV": "1"
}, {
    "LONP": "30.4",
    "LATP": "54.4",
    "SURV": "20000",
    "DIR": "R",
    "DIV": "1"
}, {
    "LONP": "29.2",
    "LATP": "54.4",
    "SURV": "20000",
    "DIR": "R",
    "DIV": "1"
}, {
    "LONP": "28.5",
    "LATP": "54.3",
    "SURV": "20000",
    "DIR": "R",
    "DIV": "1"
}, {
    "LONP": "28.3",
    "LATP": "54.4",
    "SURV": "20000",
    "DIR": "R",
    "DIV": "1"
}, {
    "LONP": "24",
    "LATP": "55.1",
    "SURV": "60000",
    "DIR": "A",
    "DIV": "2"
}, {
    "LONP": "24.5",
    "LATP": "55.2",
    "SURV": "60000",
    "DIR": "A",
    "DIV": "2"
}, {
    "LONP": "25.5",
    "LATP": "54.7",
    "SURV": "60000",
    "DIR": "A",
    "DIV": "2"
}, {
    "LONP": "26.6",
    "LATP": "55.7",
    "SURV": "40000",
    "DIR": "A",
    "DIV": "2"
}, {
    "LONP": "27.4",
    "LATP": "55.6",
    "SURV": "33000",
    "DIR": "A",
    "DIV": "2"
}, {
    "LONP": "28.7",
    "LATP": "55.5",
    "SURV": "30000",
    "DIR": "R",
    "DIV": "2"
}, {
    "LONP": "29.2",
    "LATP": "54.3",
    "SURV": "30000",
    "DIR": "R",
    "DIV": "2"
}, {
    "LONP": "28.5",
    "LATP": "54.2",
    "SURV": "30000",
    "DIR": "R",
    "DIV": "2"
}, {
    "LONP": "28.3",
    "LATP": "54.3",
    "SURV": "28000",
    "DIR": "R",
    "DIV": "2"
}, {
    "LONP": "27.5",
    "LATP": "54.5",
    "SURV": "20000",
    "DIR": "R",
    "DIV": "2"
}, {
    "LONP": "26.8",
    "LATP": "54.3",
    "SURV": "12000",
    "DIR": "R",
    "DIV": "2"
}, {
    "LONP": "26.4",
    "LATP": "54.4",
    "SURV": "14000",
    "DIR": "R",
    "DIV": "2"
}, {
    "LONP": "24.6",
    "LATP": "54.5",
    "SURV": "8000",
    "DIR": "R",
    "DIV": "2"
}, {
    "LONP": "24.4",
    "LATP": "54.4",
    "SURV": "4000",
    "DIR": "R",
    "DIV": "2"
}, {
    "LONP": "24.2",
    "LATP": "54.4",
    "SURV": "4000",
    "DIR": "R",
    "DIV": "2"
}, {
    "LONP": "24.1",
    "LATP": "54.3",
    "SURV": "4000",
    "DIR": "R",
    "DIV": "2"
}, {
    "LONP": "24",
    "LATP": "55.2",
    "SURV": "22000",
    "DIR": "A",
    "DIV": "3"
}, {
    "LONP": "24.5",
    "LATP": "55.3",
    "SURV": "22000",
    "DIR": "A",
    "DIV": "3"
}, {
    "LONP": "24.6",
    "LATP": "55.8",
    "SURV": "6000",
    "DIR": "R",
    "DIV": "3"
}, {
    "LONP": "24.2",
    "LATP": "54.4",
    "SURV": "6000",
    "DIR": "R",
    "DIV": "3"
}, {
    "LONP": "24.1",
    "LATP": "54.3",
    "SURV": "6000",
    "DIR": "R",
    "DIV": "3"
}];

var cities = [{
        "LONC": "24",
        "LATC": "55",
        "CITY": "Kowno"
    },
    {
        "LONC": "25.3",
        "LATC": "54.7",
        "CITY": "Wilna"
    },
    {
        "LONC": "26.4",
        "LATC": "54.4",
        "CITY": "Smorgoni"
    },
    {
        "LONC": "26.8",
        "LATC": "54.3",
        "CITY": "Molodexno"
    },
    {
        "LONC": "27.7",
        "LATC": "55.2",
        "CITY": "Gloubokoe"
    },
    {
        "LONC": "27.6",
        "LATC": "53.9",
        "CITY": "Minsk"
    },
    {
        "LONC": "28.5",
        "LATC": "54.3",
        "CITY": "Studienska"
    },
    {
        "LONC": "28.7",
        "LATC": "55.5",
        "CITY": "Polotzk"
    },
    {
        "LONC": "29.2",
        "LATC": "54.4",
        "CITY": "Bobr"
    },
    {
        "LONC": "30.2",
        "LATC": "55.3",
        "CITY": "Witebsk"
    },
    {
        "LONC": "30.4",
        "LATC": "54.5",
        "CITY": "Orscha"
    },
    {
        "LONC": "30.4",
        "LATC": "53.9",
        "CITY": "Mohilow"
    },
    {
        "LONC": "32",
        "LATC": "54.8",
        "CITY": "Smolensk"
    },
    {
        "LONC": "33.2",
        "LATC": "54.9",
        "CITY": "Dorogobouge"
    },
    {
        "LONC": "34.3",
        "LATC": "55.2",
        "CITY": "Wixma"
    },
    {
        "LONC": "34.4",
        "LATC": "55.5",
        "CITY": "Chjat"
    },
    {
        "LONC": "36",
        "LATC": "55.5",
        "CITY": "Mojaisk"
    },
    {
        "LONC": "37.6",
        "LATC": "55.8",
        "CITY": "Moscou"
    },
    {
        "LONC": "36.6",
        "LATC": "55.3",
        "CITY": "Tarantino"
    },
    {
        "LONC": "36.5",
        "LATC": "55",
        "CITY": "Malo-jarosewli"
    }
]


var margin = { top: 10, right: 30, bottom: 30, left: 60 },
    width = 1600 - margin.left - margin.right,
    height = 800 - margin.top - margin.bottom,
    x, y;

// append the svg object to the body of the page
var svg = d3.select("#path")
    .append("svg")
    .attr("width", width + margin.left + margin.right + 50)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

lineData = dataArrObj.map(function(point, index, arr) {
    var next = arr[index + 1],
        prev = arr[index - 1];
    return {
        LONP: parseFloat(point.LONP),
        LATP: parseFloat(point.LATP),
        x1: parseFloat(point.LONP),
        y1: parseFloat(point.LATP),
        x2: parseFloat((next) ? next.LONP : prev.LONP),
        y2: parseFloat((next) ? next.LATP : prev.LATP),
        DIR: point.DIR,
        DIV: point.DIV,
        SURV: parseFloat(point.SURV),
        index: index
    };
});

var dataArrival1 = lineData.filter(function(e) {
    return (e.DIR == "A" && e.DIV == 1);
});
var dataArrival2 = lineData.filter(function(e) {
    return (e.DIR == "A" && e.DIV == 2);
});
var dataArrival3 = lineData.filter(function(e) {
    return (e.DIR == "A" && e.DIV == 3);
});


var dataReturn1 = lineData.filter(function(e) {
    return (e.DIR == "R" && e.DIV == 1);
});
var dataReturn2 = lineData.filter(function(e) {
    return (e.DIR == "R" && e.DIV == 2);
});
var dataReturn3 = lineData.filter(function(e) {
    return (e.DIR == "R" && e.DIV == 3);
});

var dataDiv1 = lineData.filter(function(e) {
    return (e.DIV == 1);
});
var dataDiv2 = lineData.filter(function(e) {
    return (e.DIV == 2);
});
var dataDiv3 = lineData.filter(function(e) {
    return (e.DIV == 3);
});

var scaleArmySize = d3.scaleLinear()
    .domain([d3.min(lineData, function(d) { return d.SURV; }), d3.max(lineData, function(d) { return d.SURV; })])
    // .domain([22, 38])
    .range([1, 30]);

function renderAxis(data) {
    x = d3.scaleLinear()
        .domain([d3.min(data, function(d) { return d.LONP; }) - 2, d3.max(data, function(d) { return d.LONP; })])
        // .domain([22, 38])
        .range([0, width]);
    svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

    // Add Y axis
    y = d3.scaleLinear()
        .domain([d3.min(data, function(d) { return +d.LATP; }) - 0.5, d3.max(data, function(d) { return +d.LATP; })])
        // .domain([53, 56])
        .range([height, 0]);
    svg.append("g")
        .call(d3.axisLeft(y).ticks(5));
}
renderAxis(lineData)

function renderLines(data, color) {

    svg.selectAll('line#' + color)
        .data(data)
        .enter()
        .append('line')
        .attr('index', function(d, i) {
            return i;
        })
        .attr('x1', function(d) { return x(d.x1); })
        .attr('y1', function(d) { return y(d.y1); })
        .attr('x2', function(d) { return x(d.x2); })
        .attr('y2', function(d) { return y(d.y2); })
        .attr("stroke", color)
        .attr("stroke-linecap", "round")
        .attr("stroke-width", function(d) { return scaleArmySize(d.SURV); });

};



renderLines(dataDiv1, "red");
renderLines(dataDiv2, "blue");
renderLines(dataDiv3, "green");

var dots = svg.append("g").attr("class", 'cities')
dots.selectAll("dot")
    .data(cities)
    .enter().append("circle")
    .attr("r", 2.5)
    .attr("cx", function(d) { return x(d.LONC); })
    .attr("cy", function(d) { return y(d.LATC); });

dots.selectAll("text#cities")
    .data(cities)
    .enter()
    .append("text")
    .text(function(d) { return (d.CITY); })
    .attr("x", function(d) { return x(d.LONC); })
    .attr("y", function(d) { return y(d.LATC); })
    .attr("font_family", "sans-serif") // Font type
    .attr("font-size", "20px") // Font size
    .attr("fill", "darkgreen") // Font color
    .attr("font-weight", "bold")
    .attr("font-style", "italic");